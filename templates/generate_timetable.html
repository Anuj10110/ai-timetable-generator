<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Timetable - AI Timetable Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/utilities.css') }}" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/admin_common.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/generate_timetable.css') }}" rel="stylesheet">
</head>
<body>
    <button class="mobile-nav-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>
    
    <nav class="navbar-sidebar navbar-dark" id="sidebar">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <i class="fas fa-calendar-alt"></i>
                <span class="brand-text">AI Timetable</span>
            </a>
            
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('dashboard') }}">
                        <i class="fas fa-home"></i>
                        <span class="nav-text">Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('courses') }}">
                        <i class="fas fa-book"></i>
                        <span class="nav-text">Courses</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('faculty') }}">
                        <i class="fas fa-users"></i>
                        <span class="nav-text">Faculty</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('classrooms') }}">
                        <i class="fas fa-door-open"></i>
                        <span class="nav-text">Classrooms</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('batches') }}">
                        <i class="fas fa-users-cog"></i>
                        <span class="nav-text">Batches</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="{{ url_for('generate_timetable') }}">
                        <i class="fas fa-cog"></i>
                        <span class="nav-text">Generate</span>
                    </a>
                </li>
            </ul>
            
            <div class="dropdown">
                <a class="dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                    <i class="fas fa-user"></i>
                    <span class="nav-text">{{ user.username if user else 'Admin' }}</span>
                </a>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="{{ url_for('logout') }}">
                        <i class="fas fa-sign-out-alt me-2"></i>Logout
                    </a></li>
                </ul>
            </div>
        </div>
    </nav>
    
    <div class="container main-content">
        <div class="row">
            <div class="col-md-4">
                <div class="content-card">
                    <h4 class="mb-4">
                        <i class="fas fa-cog me-2 text-primary"></i>Generation Settings
                    </h4>
                    
                    <!-- Hidden settings - automatically optimized -->
                    <input type="hidden" id="solverType" value="auto">
                    <input type="hidden" id="optimize" value="true">
                    
                    <div class="mb-4">
                        <label class="form-label fw-bold">
                            <i class="fas fa-book text-primary me-2"></i>Select Courses
                        </label>
                        <div class="selection-container">
                            <div class="form-check select-all-option">
                                <input class="form-check-input" type="checkbox" id="selectAllCourses" checked>
                                <label class="form-check-label fw-bold" for="selectAllCourses">
                                    <i class="fas fa-check-double me-1"></i>Select All Courses
                                </label>
                            </div>
                            <hr class="my-3">
                            <div id="coursesList" class="scrollable-list">
                                <!-- Courses will be populated here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label fw-bold">
                            <i class="fas fa-users text-primary me-2"></i>Select Faculty
                        </label>
                        <div class="selection-container">
                            <div class="form-check select-all-option">
                                <input class="form-check-input" type="checkbox" id="selectAllFaculty" checked>
                                <label class="form-check-label fw-bold" for="selectAllFaculty">
                                    <i class="fas fa-check-double me-1"></i>Select All Faculty
                                </label>
                            </div>
                            <hr class="my-3">
                            <div id="facultyList" class="scrollable-list">
                                <!-- Faculty will be populated here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label fw-bold">
                            <i class="fas fa-users-cog text-primary me-2"></i>Select Batches
                        </label>
                        <div class="selection-container">
                            <div class="form-check select-all-option">
                                <input class="form-check-input" type="checkbox" id="selectAllBatches" checked>
                                <label class="form-check-label fw-bold" for="selectAllBatches">
                                    <i class="fas fa-check-double me-1"></i>Select All Batches
                                </label>
                            </div>
                            <hr class="my-3">
                            <div id="batchesList" class="scrollable-list">
                                <!-- Batches will be populated here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Hidden max time - system will use optimal timeout automatically -->
                    <input type="hidden" id="maxTime" value="300">
                    
                    
                    
                    <button id="generateBtn" class="btn btn-generate w-100" onclick="generateTimetable()">
                        <i class="fas fa-magic me-2"></i>Generate Timetable
                    </button>
                    
                    <div class="loading-spinner mt-4">
                        <div class="text-center">
                            <div class="spinner-border text-primary mb-3" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <h6>Generating timetable...</h6>
                            <p class="text-muted">This may take a few moments</p>
                            <div class="progress">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                     id="progressBar" style="width: 0%"></div>
                            </div>
                            <div class="mt-2">
                                <small id="statusText">Initializing...</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="status-card" id="statusCard" style="display: none;">
                    <h6><i class="fas fa-info-circle me-2"></i>Generation Status</h6>
                    <div id="statusContent"></div>
                </div>
            </div>
            
            <div class="col-md-8">
                <div class="content-card">
                    <h4 class="mb-4">
                        <i class="fas fa-table me-2 text-primary"></i>Generated Timetable
                    </h4>
                    
                    <div id="initialMessage">
                        <div class="text-center py-5">
                            <i class="fas fa-calendar-alt fa-4x text-muted mb-3"></i>
                            <h5 class="text-muted">Ready to Generate</h5>
                            <p class="text-muted">
                                Select your courses, faculty, and batches, then click "Generate Timetable" to create an AI-optimized schedule.
                            </p>
                            <div class="mt-3">
                                <small class="text-muted">
                                    <i class="fas fa-info-circle me-1"></i>
                                    The system automatically optimizes processing time based on your data complexity.
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="results-section" id="resultsSection">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="card border-0" style="background: #e8f5e8;">
                                    <div class="card-body text-center">
                                        <h5 class="card-title text-success mb-1" id="totalEntries">0</h5>
                                        <small class="text-muted">Total Classes Scheduled</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-0" style="background: #fff3e0;">
                                    <div class="card-body text-center">
                                        <h5 class="card-title text-warning mb-1" id="optimizationScore">0</h5>
                                        <small class="text-muted">Optimization Score</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table schedule-table" id="scheduleTable">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>Monday</th>
                                        <th>Tuesday</th>
                                        <th>Wednesday</th>
                                        <th>Thursday</th>
                                        <th>Friday</th>
                                    </tr>
                                </thead>
                                <tbody id="scheduleBody">
                                    <!-- Schedule entries will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="mt-4">
                            <div class="row">
                                <div class="col-md-6">
                                    <button class="btn btn-outline-primary" onclick="exportSchedule()">
                                        <i class="fas fa-download me-2"></i>Export Schedule
                                    </button>
                                </div>
                                <div class="col-md-6 text-end">
                                    <button class="btn btn-outline-secondary" onclick="showAnalysis()">
                                        <i class="fas fa-chart-line me-2"></i>View Analysis
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Analysis Modal -->
    <div class="modal fade" id="analysisModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Schedule Analysis</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="analysisContent">
                    <!-- Analysis content will be populated here -->
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/generate_timetable.js') }}"></script>
    
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('show');
        }
        
        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(event) {
            if (window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar');
                const toggleBtn = document.querySelector('.mobile-nav-toggle');
                
                if (!sidebar.contains(event.target) && !toggleBtn.contains(event.target)) {
                    sidebar.classList.remove('show');
                }
            }
        });
    </script>
</body>
</html>